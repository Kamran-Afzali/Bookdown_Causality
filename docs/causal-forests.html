<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Causal Forests | Causal Inference in R</title>
  <meta name="description" content="Chapter 7 Causal Forests | Causal Inference in R" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Causal Forests | Causal Inference in R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Causal Forests | Causal Inference in R" />
  
  
  

<meta name="author" content="Kamran Afzali" />


<meta name="date" content="2025-12-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="causal-inference-in-practice-v-regression-discontinuity-design.html"/>
<link rel="next" href="bayesian-structural-time-series-for-causal-inference.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Causality analysis in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Foundations of Causal Statistical Analysis</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#summary-table-techniques-for-causal-statistical-analysis"><i class="fa fa-check"></i><b>1.2</b> Summary Table: Techniques for Causal Statistical Analysis</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#methodological-deep-dive-with-practical-guidance"><i class="fa fa-check"></i><b>1.3</b> Methodological Deep Dive with Practical Guidance</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#discussion"><i class="fa fa-check"></i><b>1.4</b> Discussion</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#references"><i class="fa fa-check"></i><b>1.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><i class="fa fa-check"></i><b>2</b> Causal Inference in Practice I: Randomized Controlled Trials and Regression Adjustment</a>
<ul>
<li class="chapter" data-level="2.1" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#randomized-controlled-trials-design-and-analysis"><i class="fa fa-check"></i><b>2.2</b> 1. Randomized Controlled Trials: Design and Analysis</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#theoretical-foundations"><i class="fa fa-check"></i><b>2.2.1</b> Theoretical Foundations</a></li>
<li class="chapter" data-level="2.2.2" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#r-implementation"><i class="fa fa-check"></i><b>2.2.2</b> R Implementation</a></li>
<li class="chapter" data-level="2.2.3" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#model-based-inference"><i class="fa fa-check"></i><b>2.2.3</b> Model-Based Inference</a></li>
<li class="chapter" data-level="2.2.4" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#diagnostics-and-integrity"><i class="fa fa-check"></i><b>2.2.4</b> Diagnostics and Integrity</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#regression-adjustment-a-model-based-approach-to-causal-inference"><i class="fa fa-check"></i><b>2.3</b> 2. Regression Adjustment: A Model-Based Approach to Causal Inference</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#conceptual-overview"><i class="fa fa-check"></i><b>2.3.1</b> Conceptual Overview</a></li>
<li class="chapter" data-level="2.3.2" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#r-implementation-1"><i class="fa fa-check"></i><b>2.3.2</b> R Implementation</a></li>
<li class="chapter" data-level="2.3.3" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#limitations-and-diagnostics"><i class="fa fa-check"></i><b>2.3.3</b> Limitations and Diagnostics</a></li>
<li class="chapter" data-level="2.3.4" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#causal-interpretation"><i class="fa fa-check"></i><b>2.3.4</b> Causal Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#toward-integrated-reasoning"><i class="fa fa-check"></i><b>2.4</b> Toward Integrated Reasoning</a></li>
<li class="chapter" data-level="2.5" data-path="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html"><a href="causal-inference-in-practice-i-randomized-controlled-trials-and-regression-adjustment.html#conclusion"><i class="fa fa-check"></i><b>2.5</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html"><a href="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html"><i class="fa fa-check"></i><b>3</b> Causal Inference in Practice II: Propensity Scores, Doubly Robust Estimators, and Inverse Probability Weighting</a>
<ul>
<li class="chapter" data-level="3.1" data-path="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html"><a href="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html#propensity-score-methods"><i class="fa fa-check"></i><b>3.1</b> Propensity Score Methods</a></li>
<li class="chapter" data-level="3.2" data-path="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html"><a href="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html#inverse-probability-weighting-ipw"><i class="fa fa-check"></i><b>3.2</b> Inverse Probability Weighting (IPW)</a></li>
<li class="chapter" data-level="3.3" data-path="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html"><a href="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html#doubly-robust-estimators"><i class="fa fa-check"></i><b>3.3</b> Doubly Robust Estimators</a></li>
<li class="chapter" data-level="3.4" data-path="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html"><a href="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html#integrative-interpretation"><i class="fa fa-check"></i><b>3.4</b> Integrative Interpretation</a></li>
<li class="chapter" data-level="3.5" data-path="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html"><a href="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html#summary-table"><i class="fa fa-check"></i><b>3.5</b> Summary Table</a></li>
<li class="chapter" data-level="3.6" data-path="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html"><a href="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html#conclusion-1"><i class="fa fa-check"></i><b>3.6</b> Conclusion</a></li>
<li class="chapter" data-level="3.7" data-path="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html"><a href="causal-inference-in-practice-ii-propensity-scores-doubly-robust-estimators-and-inverse-probability-weighting.html#references-1"><i class="fa fa-check"></i><b>3.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html"><a href="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html"><i class="fa fa-check"></i><b>4</b> Causal Inference in Practice III: Difference-in-Differences with a Healthcare Application</a>
<ul>
<li class="chapter" data-level="4.1" data-path="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html"><a href="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html"><a href="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html#difference-in-differences-theoretical-framework"><i class="fa fa-check"></i><b>4.2</b> Difference-in-Differences: Theoretical Framework</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html"><a href="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html#core-concept"><i class="fa fa-check"></i><b>4.2.1</b> Core Concept</a></li>
<li class="chapter" data-level="4.2.2" data-path="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html"><a href="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html#mathematical-formalism"><i class="fa fa-check"></i><b>4.2.2</b> Mathematical Formalism</a></li>
<li class="chapter" data-level="4.2.3" data-path="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html"><a href="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html#key-assumption-parallel-trends"><i class="fa fa-check"></i><b>4.2.3</b> Key Assumption: Parallel Trends</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html"><a href="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html#application-evaluating-a-telemedicine-program-in-healthcare"><i class="fa fa-check"></i><b>4.3</b> Application: Evaluating a Telemedicine Program in Healthcare</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html"><a href="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html#r-implementation-2"><i class="fa fa-check"></i><b>4.3.1</b> R Implementation</a></li>
<li class="chapter" data-level="4.3.2" data-path="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html"><a href="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html#limitations-and-takeaways"><i class="fa fa-check"></i><b>4.3.2</b> Limitations and takeaways</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html"><a href="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html#conclusion-2"><i class="fa fa-check"></i><b>4.4</b> Conclusion</a></li>
<li class="chapter" data-level="4.5" data-path="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html"><a href="causal-inference-in-practice-iii-difference-in-differences-with-a-healthcare-application.html#references-2"><i class="fa fa-check"></i><b>4.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="causal-inference-in-practice-iv-instrumental-variables.html"><a href="causal-inference-in-practice-iv-instrumental-variables.html"><i class="fa fa-check"></i><b>5</b> Causal Inference in Practice IV: Instrumental Variables</a>
<ul>
<li class="chapter" data-level="5.1" data-path="causal-inference-in-practice-iv-instrumental-variables.html"><a href="causal-inference-in-practice-iv-instrumental-variables.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="causal-inference-in-practice-iv-instrumental-variables.html"><a href="causal-inference-in-practice-iv-instrumental-variables.html#healthcare-case-study-hospital-quality-and-recovery-time"><i class="fa fa-check"></i><b>5.2</b> Healthcare Case Study: Hospital Quality and Recovery Time</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="causal-inference-in-practice-iv-instrumental-variables.html"><a href="causal-inference-in-practice-iv-instrumental-variables.html#r-implementation-3"><i class="fa fa-check"></i><b>5.2.1</b> R Implementation</a></li>
<li class="chapter" data-level="5.2.2" data-path="causal-inference-in-practice-iv-instrumental-variables.html"><a href="causal-inference-in-practice-iv-instrumental-variables.html#interpreting-the-results"><i class="fa fa-check"></i><b>5.2.2</b> Interpreting the Results</a></li>
<li class="chapter" data-level="5.2.3" data-path="causal-inference-in-practice-iv-instrumental-variables.html"><a href="causal-inference-in-practice-iv-instrumental-variables.html#robustness-checks"><i class="fa fa-check"></i><b>5.2.3</b> Robustness Checks</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="causal-inference-in-practice-iv-instrumental-variables.html"><a href="causal-inference-in-practice-iv-instrumental-variables.html#practical-considerations-and-extensions"><i class="fa fa-check"></i><b>5.3</b> Practical Considerations and Extensions</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="causal-inference-in-practice-iv-instrumental-variables.html"><a href="causal-inference-in-practice-iv-instrumental-variables.html#when-to-use-iv"><i class="fa fa-check"></i><b>5.3.1</b> When to Use IV</a></li>
<li class="chapter" data-level="5.3.2" data-path="causal-inference-in-practice-iv-instrumental-variables.html"><a href="causal-inference-in-practice-iv-instrumental-variables.html#advanced-topics"><i class="fa fa-check"></i><b>5.3.2</b> Advanced Topics</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="causal-inference-in-practice-iv-instrumental-variables.html"><a href="causal-inference-in-practice-iv-instrumental-variables.html#conclusion-3"><i class="fa fa-check"></i><b>5.4</b> Conclusion</a></li>
<li class="chapter" data-level="5.5" data-path="causal-inference-in-practice-iv-instrumental-variables.html"><a href="causal-inference-in-practice-iv-instrumental-variables.html#further-reading"><i class="fa fa-check"></i><b>5.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="causal-inference-in-practice-v-regression-discontinuity-design.html"><a href="causal-inference-in-practice-v-regression-discontinuity-design.html"><i class="fa fa-check"></i><b>6</b> Causal Inference in Practice V: Regression Discontinuity Design</a>
<ul>
<li class="chapter" data-level="6.1" data-path="causal-inference-in-practice-v-regression-discontinuity-design.html"><a href="causal-inference-in-practice-v-regression-discontinuity-design.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="causal-inference-in-practice-v-regression-discontinuity-design.html"><a href="causal-inference-in-practice-v-regression-discontinuity-design.html#comparison-with-other-methods"><i class="fa fa-check"></i><b>6.1.1</b> Comparison with Other Methods</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="causal-inference-in-practice-v-regression-discontinuity-design.html"><a href="causal-inference-in-practice-v-regression-discontinuity-design.html#healthcare-application-icu-admission-and-mortality"><i class="fa fa-check"></i><b>6.2</b> Healthcare Application: ICU Admission and Mortality</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="causal-inference-in-practice-v-regression-discontinuity-design.html"><a href="causal-inference-in-practice-v-regression-discontinuity-design.html#scenario"><i class="fa fa-check"></i><b>6.2.1</b> Scenario</a></li>
<li class="chapter" data-level="6.2.2" data-path="causal-inference-in-practice-v-regression-discontinuity-design.html"><a href="causal-inference-in-practice-v-regression-discontinuity-design.html#assumptions-and-validity"><i class="fa fa-check"></i><b>6.2.2</b> Assumptions and Validity</a></li>
<li class="chapter" data-level="6.2.3" data-path="causal-inference-in-practice-v-regression-discontinuity-design.html"><a href="causal-inference-in-practice-v-regression-discontinuity-design.html#r-implementation-4"><i class="fa fa-check"></i><b>6.2.3</b> R Implementation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="causal-inference-in-practice-v-regression-discontinuity-design.html"><a href="causal-inference-in-practice-v-regression-discontinuity-design.html#interpretation-and-diagnostics"><i class="fa fa-check"></i><b>6.3</b> Interpretation and Diagnostics</a></li>
<li class="chapter" data-level="6.4" data-path="causal-inference-in-practice-v-regression-discontinuity-design.html"><a href="causal-inference-in-practice-v-regression-discontinuity-design.html#extensions-and-robustness"><i class="fa fa-check"></i><b>6.4</b> Extensions and Robustness</a></li>
<li class="chapter" data-level="6.5" data-path="causal-inference-in-practice-v-regression-discontinuity-design.html"><a href="causal-inference-in-practice-v-regression-discontinuity-design.html#limitations-and-considerations"><i class="fa fa-check"></i><b>6.5</b> Limitations and Considerations</a></li>
<li class="chapter" data-level="6.6" data-path="causal-inference-in-practice-v-regression-discontinuity-design.html"><a href="causal-inference-in-practice-v-regression-discontinuity-design.html#conclusion-4"><i class="fa fa-check"></i><b>6.6</b> Conclusion</a></li>
<li class="chapter" data-level="6.7" data-path="causal-inference-in-practice-v-regression-discontinuity-design.html"><a href="causal-inference-in-practice-v-regression-discontinuity-design.html#references-3"><i class="fa fa-check"></i><b>6.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="causal-forests.html"><a href="causal-forests.html"><i class="fa fa-check"></i><b>7</b> Causal Forests</a>
<ul>
<li class="chapter" data-level="7.1" data-path="causal-forests.html"><a href="causal-forests.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="causal-forests.html"><a href="causal-forests.html#precision-medicine-case-study-personalized-diabetes-treatment"><i class="fa fa-check"></i><b>7.2</b> Precision Medicine Case Study: Personalized Diabetes Treatment</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="causal-forests.html"><a href="causal-forests.html#data-generation-and-setup"><i class="fa fa-check"></i><b>7.2.1</b> Data Generation and Setup</a></li>
<li class="chapter" data-level="7.2.2" data-path="causal-forests.html"><a href="causal-forests.html#fitting-the-causal-forest"><i class="fa fa-check"></i><b>7.2.2</b> Fitting the Causal Forest</a></li>
<li class="chapter" data-level="7.2.3" data-path="causal-forests.html"><a href="causal-forests.html#variable-importance-analysis"><i class="fa fa-check"></i><b>7.2.3</b> Variable Importance Analysis</a></li>
<li class="chapter" data-level="7.2.4" data-path="causal-forests.html"><a href="causal-forests.html#statistical-testing-for-heterogeneity"><i class="fa fa-check"></i><b>7.2.4</b> Statistical Testing for Heterogeneity</a></li>
<li class="chapter" data-level="7.2.5" data-path="causal-forests.html"><a href="causal-forests.html#visualization-and-pattern-discovery"><i class="fa fa-check"></i><b>7.2.5</b> Visualization and Pattern Discovery</a></li>
<li class="chapter" data-level="7.2.6" data-path="causal-forests.html"><a href="causal-forests.html#personalized-treatment-strategy-development"><i class="fa fa-check"></i><b>7.2.6</b> Personalized Treatment Strategy Development</a></li>
<li class="chapter" data-level="7.2.7" data-path="causal-forests.html"><a href="causal-forests.html#partial-dependence-analysis"><i class="fa fa-check"></i><b>7.2.7</b> Partial Dependence Analysis</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="causal-forests.html"><a href="causal-forests.html#clinical-insights-and-limitations"><i class="fa fa-check"></i><b>7.3</b> Clinical Insights and Limitations</a></li>
<li class="chapter" data-level="7.4" data-path="causal-forests.html"><a href="causal-forests.html#conclusion-5"><i class="fa fa-check"></i><b>7.4</b> Conclusion</a></li>
<li class="chapter" data-level="7.5" data-path="causal-forests.html"><a href="causal-forests.html#references-4"><i class="fa fa-check"></i><b>7.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="bayesian-structural-time-series-for-causal-inference.html"><a href="bayesian-structural-time-series-for-causal-inference.html"><i class="fa fa-check"></i><b>8</b> Bayesian Structural Time Series for Causal Inference</a>
<ul>
<li class="chapter" data-level="8.1" data-path="bayesian-structural-time-series-for-causal-inference.html"><a href="bayesian-structural-time-series-for-causal-inference.html#introduction-6"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="bayesian-structural-time-series-for-causal-inference.html"><a href="bayesian-structural-time-series-for-causal-inference.html#r-implementation-examples-healthcare"><i class="fa fa-check"></i><b>8.2</b> R Implementation examples Healthcare</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="bayesian-structural-time-series-for-causal-inference.html"><a href="bayesian-structural-time-series-for-causal-inference.html#tobacco-tax-policy"><i class="fa fa-check"></i><b>8.2.1</b> Tobacco Tax Policy</a></li>
<li class="chapter" data-level="8.2.2" data-path="bayesian-structural-time-series-for-causal-inference.html"><a href="bayesian-structural-time-series-for-causal-inference.html#teletherapy-program-assessment"><i class="fa fa-check"></i><b>8.2.2</b> Teletherapy Program Assessment</a></li>
<li class="chapter" data-level="8.2.3" data-path="bayesian-structural-time-series-for-causal-inference.html"><a href="bayesian-structural-time-series-for-causal-inference.html#implementation-guidelines-for-healthcare-applications"><i class="fa fa-check"></i><b>8.2.3</b> Implementation Guidelines for Healthcare Applications</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="bayesian-structural-time-series-for-causal-inference.html"><a href="bayesian-structural-time-series-for-causal-inference.html#conclusion-6"><i class="fa fa-check"></i><b>8.3</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html"><i class="fa fa-check"></i><b>9</b> Meta-Learners for Heterogeneous Treatment Effects</a>
<ul>
<li class="chapter" data-level="9.1" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#introduction-the-promise-and-peril-of-machine-learning-for-causal-inference"><i class="fa fa-check"></i><b>9.1</b> Introduction: The Promise and Peril of Machine Learning for Causal Inference</a></li>
<li class="chapter" data-level="9.2" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#theoretical-foundation-from-prediction-to-causal-inference"><i class="fa fa-check"></i><b>9.2</b> Theoretical Foundation: From Prediction to Causal Inference</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#the-s-learner-simplicity-with-hidden-complexity"><i class="fa fa-check"></i><b>9.2.1</b> The S-Learner: Simplicity with Hidden Complexity</a></li>
<li class="chapter" data-level="9.2.2" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#the-t-learner-divide-and-conquer"><i class="fa fa-check"></i><b>9.2.2</b> The T-Learner: Divide and Conquer</a></li>
<li class="chapter" data-level="9.2.3" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#the-x-learner-sophisticated-synthesis"><i class="fa fa-check"></i><b>9.2.3</b> The X-Learner: Sophisticated Synthesis</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#practical-implementation-hypertension-treatment-optimization"><i class="fa fa-check"></i><b>9.3</b> Practical Implementation: Hypertension Treatment Optimization</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#implementing-the-s-learner"><i class="fa fa-check"></i><b>9.3.1</b> Implementing the S-Learner</a></li>
<li class="chapter" data-level="9.3.2" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#implementing-the-t-learner"><i class="fa fa-check"></i><b>9.3.2</b> Implementing the T-Learner</a></li>
<li class="chapter" data-level="9.3.3" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#implementing-the-x-learner"><i class="fa fa-check"></i><b>9.3.3</b> Implementing the X-Learner</a></li>
<li class="chapter" data-level="9.3.4" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#comparative-analysis-and-model-selection"><i class="fa fa-check"></i><b>9.3.4</b> Comparative Analysis and Model Selection</a></li>
<li class="chapter" data-level="9.3.5" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#clinical-pattern-discovery-and-interpretation"><i class="fa fa-check"></i><b>9.3.5</b> Clinical Pattern Discovery and Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#implementation-considerations-and-best-practices"><i class="fa fa-check"></i><b>9.4</b> Implementation Considerations and Best Practices</a></li>
<li class="chapter" data-level="9.5" data-path="meta-learners-for-heterogeneous-treatment-effects.html"><a href="meta-learners-for-heterogeneous-treatment-effects.html#conclusion-democratizing-causal-machine-learning"><i class="fa fa-check"></i><b>9.5</b> Conclusion: Democratizing Causal Machine Learning</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="targeted-maximum-likelihood-estimation-for-robust-causal-inference-in-healthcare.html"><a href="targeted-maximum-likelihood-estimation-for-robust-causal-inference-in-healthcare.html"><i class="fa fa-check"></i><b>10</b> Targeted Maximum Likelihood Estimation for Robust Causal Inference in Healthcare</a>
<ul>
<li class="chapter" data-level="10.1" data-path="targeted-maximum-likelihood-estimation-for-robust-causal-inference-in-healthcare.html"><a href="targeted-maximum-likelihood-estimation-for-robust-causal-inference-in-healthcare.html#introduction-7"><i class="fa fa-check"></i><b>10.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="targeted-maximum-likelihood-estimation-for-robust-causal-inference-in-healthcare.html"><a href="targeted-maximum-likelihood-estimation-for-robust-causal-inference-in-healthcare.html#double-robustness-and-tmle"><i class="fa fa-check"></i><b>10.1.1</b> Double Robustness and TMLE</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="targeted-maximum-likelihood-estimation-for-robust-causal-inference-in-healthcare.html"><a href="targeted-maximum-likelihood-estimation-for-robust-causal-inference-in-healthcare.html#healthcare-application-comparative-effectiveness-of-hypertension-treatments"><i class="fa fa-check"></i><b>10.2</b> Healthcare Application: Comparative Effectiveness of Hypertension Treatments</a></li>
<li class="chapter" data-level="10.3" data-path="targeted-maximum-likelihood-estimation-for-robust-causal-inference-in-healthcare.html"><a href="targeted-maximum-likelihood-estimation-for-robust-causal-inference-in-healthcare.html#limitations-and-practical-implementation"><i class="fa fa-check"></i><b>10.3</b> Limitations and Practical Implementation</a></li>
<li class="chapter" data-level="10.4" data-path="targeted-maximum-likelihood-estimation-for-robust-causal-inference-in-healthcare.html"><a href="targeted-maximum-likelihood-estimation-for-robust-causal-inference-in-healthcare.html#conclusion-7"><i class="fa fa-check"></i><b>10.4</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="g-computation-for-causal-inference.html"><a href="g-computation-for-causal-inference.html"><i class="fa fa-check"></i><b>11</b> G-Computation for Causal Inference</a>
<ul>
<li class="chapter" data-level="11.1" data-path="g-computation-for-causal-inference.html"><a href="g-computation-for-causal-inference.html#introduction-8"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="g-computation-for-causal-inference.html"><a href="g-computation-for-causal-inference.html#case-study-hypertension-management-over-time"><i class="fa fa-check"></i><b>11.2</b> Case Study: Hypertension Management Over Time</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="g-computation-for-causal-inference.html"><a href="g-computation-for-causal-inference.html#fitting-the-g-formula-model"><i class="fa fa-check"></i><b>11.2.1</b> Fitting the G-Formula Model</a></li>
<li class="chapter" data-level="11.2.2" data-path="g-computation-for-causal-inference.html"><a href="g-computation-for-causal-inference.html#interpreting-results-and-model-diagnostics"><i class="fa fa-check"></i><b>11.2.2</b> Interpreting Results and Model Diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="g-computation-for-causal-inference.html"><a href="g-computation-for-causal-inference.html#practical-considerations-and-limitations"><i class="fa fa-check"></i><b>11.3</b> Practical Considerations and Limitations</a></li>
<li class="chapter" data-level="11.4" data-path="g-computation-for-causal-inference.html"><a href="g-computation-for-causal-inference.html#conclusion-integrating-g-computation-into-practice"><i class="fa fa-check"></i><b>11.4</b> Conclusion: Integrating G-Computation into Practice</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="structural-equation-modeling-for-healthcare-research-unraveling-complex-causal-pathways.html"><a href="structural-equation-modeling-for-healthcare-research-unraveling-complex-causal-pathways.html"><i class="fa fa-check"></i><b>12</b> Structural Equation Modeling for Healthcare Research: Unraveling Complex Causal Pathways</a>
<ul>
<li class="chapter" data-level="12.1" data-path="structural-equation-modeling-for-healthcare-research-unraveling-complex-causal-pathways.html"><a href="structural-equation-modeling-for-healthcare-research-unraveling-complex-causal-pathways.html#introduction-9"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="structural-equation-modeling-for-healthcare-research-unraveling-complex-causal-pathways.html"><a href="structural-equation-modeling-for-healthcare-research-unraveling-complex-causal-pathways.html#a-mediation-analysis-physical-activity-mental-health-and-diabetes-control"><i class="fa fa-check"></i><b>12.2</b> A Mediation Analysis: Physical Activity, Mental Health, and Diabetes Control</a></li>
<li class="chapter" data-level="12.3" data-path="structural-equation-modeling-for-healthcare-research-unraveling-complex-causal-pathways.html"><a href="structural-equation-modeling-for-healthcare-research-unraveling-complex-causal-pathways.html#clinical-interpretation-and-limitations"><i class="fa fa-check"></i><b>12.3</b> Clinical Interpretation and Limitations</a></li>
<li class="chapter" data-level="12.4" data-path="structural-equation-modeling-for-healthcare-research-unraveling-complex-causal-pathways.html"><a href="structural-equation-modeling-for-healthcare-research-unraveling-complex-causal-pathways.html#conclusion-8"><i class="fa fa-check"></i><b>12.4</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html"><a href="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html"><i class="fa fa-check"></i><b>13</b> Directed Acyclic Graphs: Mapping the Causal Architecture of Healthcare Decisions</a>
<ul>
<li class="chapter" data-level="13.1" data-path="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html"><a href="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html#introduction-10"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html"><a href="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html#implementing-dag-analysis-in-healthcare-research"><i class="fa fa-check"></i><b>13.2</b> Implementing DAG Analysis in Healthcare Research</a></li>
<li class="chapter" data-level="13.3" data-path="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html"><a href="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html#comparing-analytical-strategies"><i class="fa fa-check"></i><b>13.3</b> Comparing Analytical Strategies</a></li>
<li class="chapter" data-level="13.4" data-path="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html"><a href="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html#visualizing-causal-structures-for-communication"><i class="fa fa-check"></i><b>13.4</b> Visualizing Causal Structures for Communication</a></li>
<li class="chapter" data-level="13.5" data-path="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html"><a href="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html#sensitivity-analysis-and-unmeasured-confounding"><i class="fa fa-check"></i><b>13.5</b> Sensitivity Analysis and Unmeasured Confounding</a></li>
<li class="chapter" data-level="13.6" data-path="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html"><a href="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html#testable-implications-and-dag-validation"><i class="fa fa-check"></i><b>13.6</b> Testable Implications and DAG Validation</a></li>
<li class="chapter" data-level="13.7" data-path="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html"><a href="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html#practical-guidance-for-healthcare-applications"><i class="fa fa-check"></i><b>13.7</b> Practical Guidance for Healthcare Applications</a></li>
<li class="chapter" data-level="13.8" data-path="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html"><a href="directed-acyclic-graphs-mapping-the-causal-architecture-of-healthcare-decisions.html#conclusion-dags-as-foundation-for-rigorous-causal-inference"><i class="fa fa-check"></i><b>13.8</b> Conclusion: DAGs as Foundation for Rigorous Causal Inference</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="double-machine-learning.html"><a href="double-machine-learning.html"><i class="fa fa-check"></i><b>14</b> Double Machine Learning</a>
<ul>
<li class="chapter" data-level="14.1" data-path="double-machine-learning.html"><a href="double-machine-learning.html#introduction-11"><i class="fa fa-check"></i><b>14.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="double-machine-learning.html"><a href="double-machine-learning.html#theoretical-framework-understanding-the-double-machine-learning-approach"><i class="fa fa-check"></i><b>14.1.1</b> Theoretical Framework: Understanding the Double Machine Learning Approach</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="double-machine-learning.html"><a href="double-machine-learning.html#cardiovascular-disease-prevention-a-dml-case-study"><i class="fa fa-check"></i><b>14.2</b> Cardiovascular Disease Prevention: A DML Case Study</a></li>
<li class="chapter" data-level="14.3" data-path="double-machine-learning.html"><a href="double-machine-learning.html#clinical-interpretation-and-implementation"><i class="fa fa-check"></i><b>14.3</b> Clinical Interpretation and Implementation</a></li>
<li class="chapter" data-level="14.4" data-path="double-machine-learning.html"><a href="double-machine-learning.html#understanding-assumptions-and-potential-violations"><i class="fa fa-check"></i><b>14.4</b> Understanding Assumptions and Potential Violations</a></li>
<li class="chapter" data-level="14.5" data-path="double-machine-learning.html"><a href="double-machine-learning.html#extensions-and-advanced-applications"><i class="fa fa-check"></i><b>14.5</b> Extensions and Advanced Applications</a></li>
<li class="chapter" data-level="14.6" data-path="double-machine-learning.html"><a href="double-machine-learning.html#conclusion-9"><i class="fa fa-check"></i><b>14.6</b> Conclusion</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Causal Inference in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="causal-forests" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Causal Forests<a href="causal-forests.html#causal-forests" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-5" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Introduction<a href="causal-forests.html#introduction-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Imagine you’re a physician prescribing a promising new diabetes medication. Clinical trials show an average improvement of 0.8 percentage points in HbA1c levels, but you know that averages can be misleading. Some patients might experience dramatic improvements exceeding 2 percentage points, while others show minimal response. The critical question isn’t whether the treatment works on average, but which specific patients will benefit most.</p>
<p>This is the fundamental challenge of treatment effect heterogeneity—understanding how treatment benefits vary across individuals based on their unique characteristics. Traditional clinical trials provide population-level answers, but modern precision medicine demands individual-level predictions.</p>
<p>Causal forests represent a breakthrough solution that combines machine learning’s pattern-recognition capabilities with causal inference’s statistical rigor. Unlike conventional approaches that estimate single average effects or require researchers to prespecify which patient characteristics matter, causal forests automatically discover complex patterns of treatment variation while providing statistically valid confidence intervals for individual predictions.</p>
<p>Traditional regression models make restrictive assumptions about treatment effects. They assume treatment works identically for everyone, require researchers to guess which characteristics modify treatment effects, and assume effects vary smoothly and predictably across patient characteristics. These assumptions severely limit our ability to capture the complex, nonlinear patterns that characterize real-world treatment responses. A diabetes medication might work exceptionally well for younger patients with poor glycemic control while providing minimal benefit to older patients with better baseline management—a pattern invisible to standard linear models unless specifically hypothesized in advance.</p>
<p>Causal forests overcome these limitations through three key innovations. They automatically identify treatment effect patterns without requiring researchers to specify them beforehand, provide nonparametric flexibility that allows complex, nonlinear relationships to emerge naturally from the data, and ensure honest statistical inference with valid confidence intervals that account for both sampling uncertainty and model selection uncertainty.</p>
<p>This methodology transforms precision medicine by enabling truly personalized treatment recommendations grounded in rigorous statistical evidence rather than clinical intuition alone.</p>
<p>Causal forests extend the beloved random forest algorithm from prediction to causal inference, but with a crucial modification in objective function. While traditional random forests split tree nodes to maximize predictive accuracy, causal forests split nodes to maximize treatment effect heterogeneity.</p>
<p>Consider our clinical dataset with <span class="math inline">\(n\)</span> patients, where each patient <span class="math inline">\(i\)</span> has observable characteristics <span class="math inline">\(X_i\)</span> (age, BMI, medical history), treatment assignment <span class="math inline">\(W_i\)</span> (new drug vs. standard care), and observed outcome <span class="math inline">\(Y_i\)</span> (change in HbA1c levels).</p>
<p>Under the potential outcomes framework, each patient has two potential outcomes: <span class="math inline">\(Y_i(0)\)</span> representing the outcome under standard care and <span class="math inline">\(Y_i(1)\)</span> representing the outcome under new treatment. The individual treatment effect is <span class="math inline">\(\tau_i = Y_i(1) - Y_i(0)\)</span>, but we face the fundamental problem of causal inference—we never observe both potential outcomes for the same individual.</p>
<p>Causal forests estimate the conditional average treatment effect function <span class="math inline">\(\tau(x) = \mathbb{E}[Y_i(1) - Y_i(0) | X_i = x]\)</span>. This function represents the expected treatment benefit for patients with characteristics <span class="math inline">\(x\)</span>, enabling personalized predictions for new patients.</p>
<p>Three assumptions enable causal identification. Unconfoundedness requires that treatment assignment is effectively random conditional on observed characteristics, expressed as <span class="math inline">\(\{Y_i(0), Y_i(1)\} \perp W_i | X_i\)</span>. This rules out hidden factors that influence both treatment decisions and outcomes. The overlap assumption ensures that patients with similar characteristics have positive probability of receiving either treatment: <span class="math inline">\(0 &lt; \mathbb{P}(W_i = 1 | X_i = x) &lt; 1\)</span> for all <span class="math inline">\(x\)</span>. This guarantees we observe both treated and control patients across the covariate space. Finally, the Stable Unit Treatment Value Assumption (SUTVA) requires that each patient’s potential outcomes depend only on their own treatment, ruling out interference effects where one patient’s treatment affects another’s outcomes.</p>
<p>The algorithmic breakthrough lies in the splitting criterion that guides tree construction. For a candidate split partitioning observations into sets <span class="math inline">\(S_L\)</span> and <span class="math inline">\(S_R\)</span>, the algorithm evaluates <span class="math inline">\(\Delta(S, S_L, S_R) = |S_L| \cdot (\hat{\tau}(S_L) - \hat{\tau}(S))^2 + |S_R| \cdot (\hat{\tau}(S_R) - \hat{\tau}(S))^2\)</span>. This criterion prefers splits that create child nodes with treatment effects substantially different from the parent node, thereby maximizing treatment effect heterogeneity rather than outcome predictability.</p>
<p>Honesty ensures valid statistical inference through strict sample splitting. The algorithm uses one subsample to determine tree structure (which variables to split on and where) and a completely separate subsample to estimate treatment effects within each leaf. This separation prevents overfitting that would invalidate confidence intervals and hypothesis tests, ensuring the algorithm’s adaptivity doesn’t compromise statistical rigor.</p>
<p>When predicting treatment effects for a new patient with characteristics <span class="math inline">\(x\)</span>, causal forests use sophisticated weighting that adapts to local data density. The weight assigned to training patient <span class="math inline">\(i\)</span> when making predictions for the new patient is calculated as <span class="math inline">\(\alpha_i(x) = \frac{1}{B} \sum_{b=1}^{B} \frac{\mathbf{1}(X_i \in L_b(x))}{|L_b(x)|}\)</span>, where <span class="math inline">\(B\)</span> represents the number of trees, <span class="math inline">\(L_b(x)\)</span> is the leaf containing <span class="math inline">\(x\)</span> in tree <span class="math inline">\(b\)</span>, and <span class="math inline">\(|L_b(x)|\)</span> is the number of training patients in that leaf.</p>
<p>This weighting gives more influence to patients similar to the prediction target across multiple trees, naturally adapting to local data density. The final treatment effect estimate becomes <span class="math inline">\(\hat{\tau}(x) = \sum_{i=1}^{n} \alpha_i(x) \cdot W_i \cdot Y_i - \sum_{i=1}^{n} \alpha_i(x) \cdot (1-W_i) \cdot Y_i\)</span>, which represents a locally-weighted difference in means between treated and control patients similar to the prediction target.</p>
<p>The theoretical guarantee of asymptotic normality enables construction of honest confidence intervals. The asymptotic variance <span class="math inline">\(\text{Var}(\hat{\tau}(x)) = \sigma^2(x) \cdot V(x)\)</span> depends on both the conditional variance of outcomes <span class="math inline">\(\sigma^2(x)\)</span> and the effective sample size <span class="math inline">\(V(x)\)</span> accounting for forest weighting. These honest confidence intervals represent a major advance over naive machine learning approaches by explicitly accounting for model selection uncertainty.</p>
</div>
<div id="precision-medicine-case-study-personalized-diabetes-treatment" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Precision Medicine Case Study: Personalized Diabetes Treatment<a href="causal-forests.html#precision-medicine-case-study-personalized-diabetes-treatment" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll explore causal forests through a realistic scenario involving a new diabetes medication with heterogeneous effects. Our analysis aims to develop personalized treatment recommendations by estimating conditional treatment effects as functions of age, BMI, baseline HbA1c levels, and comorbidity indicators including hypertension, cardiovascular disease, and kidney disease. The outcome is change in HbA1c levels after six months, where more negative values indicate better glycemic control.</p>
<div id="data-generation-and-setup" class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Data Generation and Setup<a href="causal-forests.html#data-generation-and-setup" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="causal-forests.html#cb108-1" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb108-2"><a href="causal-forests.html#cb108-2" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;grf&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(<span class="st">&quot;grf&quot;</span>)</span>
<span id="cb108-3"><a href="causal-forests.html#cb108-3" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;ggplot2&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb108-4"><a href="causal-forests.html#cb108-4" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb108-5"><a href="causal-forests.html#cb108-5" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;reshape2&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(<span class="st">&quot;reshape2&quot;</span>)</span>
<span id="cb108-6"><a href="causal-forests.html#cb108-6" tabindex="-1"></a></span>
<span id="cb108-7"><a href="causal-forests.html#cb108-7" tabindex="-1"></a><span class="fu">library</span>(grf)</span>
<span id="cb108-8"><a href="causal-forests.html#cb108-8" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb108-9"><a href="causal-forests.html#cb108-9" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb108-10"><a href="causal-forests.html#cb108-10" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;reshape2&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     smiths</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="causal-forests.html#cb111-1" tabindex="-1"></a><span class="co"># Set seed for reproducible results</span></span>
<span id="cb111-2"><a href="causal-forests.html#cb111-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb111-3"><a href="causal-forests.html#cb111-3" tabindex="-1"></a></span>
<span id="cb111-4"><a href="causal-forests.html#cb111-4" tabindex="-1"></a><span class="co"># Simulate realistic patient population</span></span>
<span id="cb111-5"><a href="causal-forests.html#cb111-5" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb111-6"><a href="causal-forests.html#cb111-6" tabindex="-1"></a></span>
<span id="cb111-7"><a href="causal-forests.html#cb111-7" tabindex="-1"></a><span class="co"># Generate patient characteristics with realistic distributions</span></span>
<span id="cb111-8"><a href="causal-forests.html#cb111-8" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">25</span>, <span class="fu">pmin</span>(<span class="dv">85</span>, <span class="fu">rnorm</span>(n, <span class="dv">60</span>, <span class="dv">12</span>)))  <span class="co"># Age 25-85, mean 60</span></span>
<span id="cb111-9"><a href="causal-forests.html#cb111-9" tabindex="-1"></a>bmi <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">20</span>, <span class="fu">pmin</span>(<span class="dv">50</span>, <span class="fu">rnorm</span>(n, <span class="dv">30</span>, <span class="dv">6</span>)))   <span class="co"># BMI 20-50, mean 30</span></span>
<span id="cb111-10"><a href="causal-forests.html#cb111-10" tabindex="-1"></a>baseline_hba1c <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="fl">6.0</span>, <span class="fu">pmin</span>(<span class="fl">12.0</span>, <span class="fu">rnorm</span>(n, <span class="fl">8.5</span>, <span class="fl">1.2</span>)))  <span class="co"># HbA1c 6-12%, mean 8.5%</span></span>
<span id="cb111-11"><a href="causal-forests.html#cb111-11" tabindex="-1"></a></span>
<span id="cb111-12"><a href="causal-forests.html#cb111-12" tabindex="-1"></a><span class="co"># Binary comorbidity indicators</span></span>
<span id="cb111-13"><a href="causal-forests.html#cb111-13" tabindex="-1"></a>hypertension <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.6</span>)     <span class="co"># 60% prevalence</span></span>
<span id="cb111-14"><a href="causal-forests.html#cb111-14" tabindex="-1"></a>cvd <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.3</span>)              <span class="co"># 30% prevalence  </span></span>
<span id="cb111-15"><a href="causal-forests.html#cb111-15" tabindex="-1"></a>kidney_disease <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.25</span>)  <span class="co"># 25% prevalence</span></span>
<span id="cb111-16"><a href="causal-forests.html#cb111-16" tabindex="-1"></a></span>
<span id="cb111-17"><a href="causal-forests.html#cb111-17" tabindex="-1"></a><span class="co"># Combine covariates into matrix</span></span>
<span id="cb111-18"><a href="causal-forests.html#cb111-18" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(age, bmi, baseline_hba1c, hypertension, cvd, kidney_disease)</span>
<span id="cb111-19"><a href="causal-forests.html#cb111-19" tabindex="-1"></a><span class="fu">colnames</span>(X) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;bmi&quot;</span>, <span class="st">&quot;baseline_hba1c&quot;</span>, <span class="st">&quot;hypertension&quot;</span>, <span class="st">&quot;cvd&quot;</span>, <span class="st">&quot;kidney_disease&quot;</span>)</span>
<span id="cb111-20"><a href="causal-forests.html#cb111-20" tabindex="-1"></a></span>
<span id="cb111-21"><a href="causal-forests.html#cb111-21" tabindex="-1"></a><span class="co"># Randomized treatment assignment</span></span>
<span id="cb111-22"><a href="causal-forests.html#cb111-22" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb111-23"><a href="causal-forests.html#cb111-23" tabindex="-1"></a></span>
<span id="cb111-24"><a href="causal-forests.html#cb111-24" tabindex="-1"></a><span class="co"># Generate heterogeneous treatment effects</span></span>
<span id="cb111-25"><a href="causal-forests.html#cb111-25" tabindex="-1"></a><span class="co"># Younger patients and those with worse baseline control benefit more</span></span>
<span id="cb111-26"><a href="causal-forests.html#cb111-26" tabindex="-1"></a>true_tau <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">-</span> <span class="fl">0.02</span> <span class="sc">*</span> (age <span class="sc">-</span> <span class="dv">60</span>) <span class="sc">-</span> <span class="fl">0.3</span> <span class="sc">*</span> (baseline_hba1c <span class="sc">-</span> <span class="fl">8.5</span>)</span>
<span id="cb111-27"><a href="causal-forests.html#cb111-27" tabindex="-1"></a>true_tau <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fu">pmin</span>(<span class="dv">0</span>, true_tau))  <span class="co"># Constrain to realistic range</span></span>
<span id="cb111-28"><a href="causal-forests.html#cb111-28" tabindex="-1"></a></span>
<span id="cb111-29"><a href="causal-forests.html#cb111-29" tabindex="-1"></a><span class="co"># Generate outcomes under potential outcomes framework</span></span>
<span id="cb111-30"><a href="causal-forests.html#cb111-30" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.3</span> <span class="sc">+</span> <span class="fl">0.01</span> <span class="sc">*</span> age <span class="sc">+</span> <span class="fl">0.02</span> <span class="sc">*</span> bmi <span class="sc">+</span> <span class="fl">0.1</span> <span class="sc">*</span> baseline_hba1c <span class="sc">+</span> </span>
<span id="cb111-31"><a href="causal-forests.html#cb111-31" tabindex="-1"></a>      <span class="fl">0.2</span> <span class="sc">*</span> hypertension <span class="sc">+</span> <span class="fl">0.15</span> <span class="sc">*</span> cvd <span class="sc">+</span> <span class="fl">0.25</span> <span class="sc">*</span> kidney_disease <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.8</span>)</span>
<span id="cb111-32"><a href="causal-forests.html#cb111-32" tabindex="-1"></a></span>
<span id="cb111-33"><a href="causal-forests.html#cb111-33" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> Y0 <span class="sc">+</span> true_tau <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.3</span>)</span>
<span id="cb111-34"><a href="causal-forests.html#cb111-34" tabindex="-1"></a></span>
<span id="cb111-35"><a href="causal-forests.html#cb111-35" tabindex="-1"></a><span class="co"># Observed outcomes</span></span>
<span id="cb111-36"><a href="causal-forests.html#cb111-36" tabindex="-1"></a>Y <span class="ot">&lt;-</span> W <span class="sc">*</span> Y1 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> W) <span class="sc">*</span> Y0</span>
<span id="cb111-37"><a href="causal-forests.html#cb111-37" tabindex="-1"></a></span>
<span id="cb111-38"><a href="causal-forests.html#cb111-38" tabindex="-1"></a><span class="co"># Create dataset</span></span>
<span id="cb111-39"><a href="causal-forests.html#cb111-39" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(X, <span class="at">W =</span> W, <span class="at">Y =</span> Y, <span class="at">true_tau =</span> true_tau)</span>
<span id="cb111-40"><a href="causal-forests.html#cb111-40" tabindex="-1"></a></span>
<span id="cb111-41"><a href="causal-forests.html#cb111-41" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Dataset Summary:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Dataset Summary:</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="causal-forests.html#cb113-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Total patients:&quot;</span>, n, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Total patients: 2000</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="causal-forests.html#cb115-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Control group:&quot;</span>, <span class="fu">sum</span>(W <span class="sc">==</span> <span class="dv">0</span>), <span class="st">&quot;patients</span><span class="sc">\n</span><span class="st">&quot;</span>) </span></code></pre></div>
<pre><code>## Control group: 979 patients</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="causal-forests.html#cb117-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Treatment group:&quot;</span>, <span class="fu">sum</span>(W <span class="sc">==</span> <span class="dv">1</span>), <span class="st">&quot;patients</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Treatment group: 1021 patients</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="causal-forests.html#cb119-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean outcome - Control:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Y[W <span class="sc">==</span> <span class="dv">0</span>]), <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Mean outcome - Control: 1.994</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="causal-forests.html#cb121-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean outcome - Treatment:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Y[W <span class="sc">==</span> <span class="dv">1</span>]), <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Mean outcome - Treatment: 1.472</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="causal-forests.html#cb123-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Naive ATE estimate:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Y[W <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">mean</span>(Y[W <span class="sc">==</span> <span class="dv">0</span>]), <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Naive ATE estimate: -0.522</code></pre>
</div>
<div id="fitting-the-causal-forest" class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Fitting the Causal Forest<a href="causal-forests.html#fitting-the-causal-forest" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="causal-forests.html#cb125-1" tabindex="-1"></a><span class="co"># Fit causal forest with optimal hyperparameters</span></span>
<span id="cb125-2"><a href="causal-forests.html#cb125-2" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">causal_forest</span>(X, Y, W,</span>
<span id="cb125-3"><a href="causal-forests.html#cb125-3" tabindex="-1"></a>                    <span class="at">num.trees =</span> <span class="dv">2000</span>,        <span class="co"># Sufficient for stable estimates</span></span>
<span id="cb125-4"><a href="causal-forests.html#cb125-4" tabindex="-1"></a>                    <span class="at">honesty =</span> <span class="cn">TRUE</span>,          <span class="co"># Enable honest inference</span></span>
<span id="cb125-5"><a href="causal-forests.html#cb125-5" tabindex="-1"></a>                    <span class="at">honesty.fraction =</span> <span class="fl">0.5</span>,  <span class="co"># Split sample equally</span></span>
<span id="cb125-6"><a href="causal-forests.html#cb125-6" tabindex="-1"></a>                    <span class="at">ci.group.size =</span> <span class="dv">2</span>)       <span class="co"># Individual confidence intervals</span></span>
<span id="cb125-7"><a href="causal-forests.html#cb125-7" tabindex="-1"></a></span>
<span id="cb125-8"><a href="causal-forests.html#cb125-8" tabindex="-1"></a><span class="co"># Generate predictions and uncertainty estimates</span></span>
<span id="cb125-9"><a href="causal-forests.html#cb125-9" tabindex="-1"></a>tau_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(cf)<span class="sc">$</span>predictions</span>
<span id="cb125-10"><a href="causal-forests.html#cb125-10" tabindex="-1"></a>tau_se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">predict</span>(cf, <span class="at">estimate.variance =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>variance.estimates)</span>
<span id="cb125-11"><a href="causal-forests.html#cb125-11" tabindex="-1"></a></span>
<span id="cb125-12"><a href="causal-forests.html#cb125-12" tabindex="-1"></a><span class="co"># Construct confidence intervals</span></span>
<span id="cb125-13"><a href="causal-forests.html#cb125-13" tabindex="-1"></a>tau_lower <span class="ot">&lt;-</span> tau_hat <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> tau_se</span>
<span id="cb125-14"><a href="causal-forests.html#cb125-14" tabindex="-1"></a>tau_upper <span class="ot">&lt;-</span> tau_hat <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> tau_se</span>
<span id="cb125-15"><a href="causal-forests.html#cb125-15" tabindex="-1"></a></span>
<span id="cb125-16"><a href="causal-forests.html#cb125-16" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Causal Forest Performance:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Causal Forest Performance:</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="causal-forests.html#cb127-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean predicted effect:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(tau_hat), <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Mean predicted effect: -0.536</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="causal-forests.html#cb129-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;SD of predicted effects:&quot;</span>, <span class="fu">round</span>(<span class="fu">sd</span>(tau_hat), <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## SD of predicted effects: 0.317</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="causal-forests.html#cb131-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean true effect:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(true_tau), <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Mean true effect: -0.535</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="causal-forests.html#cb133-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Prediction correlation:&quot;</span>, <span class="fu">round</span>(<span class="fu">cor</span>(true_tau, tau_hat), <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Prediction correlation: 0.949</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="causal-forests.html#cb135-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean confidence interval width:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(tau_upper <span class="sc">-</span> tau_lower), <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Mean confidence interval width: 0.493</code></pre>
<p>The causal forest achieves excellent performance, with strong correlation between predicted and true treatment effects demonstrating the algorithm’s ability to recover heterogeneous patterns. The 2000 trees provide stable estimates while the honest inference procedure ensures valid confidence intervals.</p>
</div>
<div id="variable-importance-analysis" class="section level3 hasAnchor" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Variable Importance Analysis<a href="causal-forests.html#variable-importance-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="causal-forests.html#cb137-1" tabindex="-1"></a><span class="co"># Analyze what drives treatment effect heterogeneity</span></span>
<span id="cb137-2"><a href="causal-forests.html#cb137-2" tabindex="-1"></a>var_importance <span class="ot">&lt;-</span> <span class="fu">variable_importance</span>(cf)</span>
<span id="cb137-3"><a href="causal-forests.html#cb137-3" tabindex="-1"></a>importance_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb137-4"><a href="causal-forests.html#cb137-4" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">colnames</span>(X),</span>
<span id="cb137-5"><a href="causal-forests.html#cb137-5" tabindex="-1"></a>  <span class="at">Importance =</span> var_importance</span>
<span id="cb137-6"><a href="causal-forests.html#cb137-6" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb137-7"><a href="causal-forests.html#cb137-7" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Importance))</span>
<span id="cb137-8"><a href="causal-forests.html#cb137-8" tabindex="-1"></a></span>
<span id="cb137-9"><a href="causal-forests.html#cb137-9" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Variable Importance Rankings:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Variable Importance Rankings:</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="causal-forests.html#cb139-1" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(importance_df)) {</span>
<span id="cb139-2"><a href="causal-forests.html#cb139-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%d. %s: %.3f</span><span class="sc">\n</span><span class="st">&quot;</span>, i, importance_df<span class="sc">$</span>Variable[i], importance_df<span class="sc">$</span>Importance[i]))</span>
<span id="cb139-3"><a href="causal-forests.html#cb139-3" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## 1. baseline_hba1c: 0.536
## 2. age: 0.337
## 3. bmi: 0.080
## 4. kidney_disease: 0.023
## 5. hypertension: 0.013
## 6. cvd: 0.011</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="causal-forests.html#cb141-1" tabindex="-1"></a><span class="co"># Visualize importance</span></span>
<span id="cb141-2"><a href="causal-forests.html#cb141-2" tabindex="-1"></a>p_importance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(importance_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Variable, Importance), <span class="at">y =</span> Importance)) <span class="sc">+</span></span>
<span id="cb141-3"><a href="causal-forests.html#cb141-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb141-4"><a href="causal-forests.html#cb141-4" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb141-5"><a href="causal-forests.html#cb141-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Variable Importance for Treatment Effect Heterogeneity&quot;</span>,</span>
<span id="cb141-6"><a href="causal-forests.html#cb141-6" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Which patient characteristics drive treatment variation?&quot;</span>,</span>
<span id="cb141-7"><a href="causal-forests.html#cb141-7" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Patient Characteristics&quot;</span>, </span>
<span id="cb141-8"><a href="causal-forests.html#cb141-8" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Importance Score&quot;</span>) <span class="sc">+</span></span>
<span id="cb141-9"><a href="causal-forests.html#cb141-9" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb141-10"><a href="causal-forests.html#cb141-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span>
<span id="cb141-11"><a href="causal-forests.html#cb141-11" tabindex="-1"></a></span>
<span id="cb141-12"><a href="causal-forests.html#cb141-12" tabindex="-1"></a><span class="fu">print</span>(p_importance)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Variable importance analysis reveals which patient characteristics drive treatment effect heterogeneity most strongly. As expected from our simulation design, baseline HbA1c and age emerge as the most important predictors, reflecting the clinical reality that patients with worse initial glycemic control and younger age tend to respond better to new diabetes medications.</p>
</div>
<div id="statistical-testing-for-heterogeneity" class="section level3 hasAnchor" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> Statistical Testing for Heterogeneity<a href="causal-forests.html#statistical-testing-for-heterogeneity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="causal-forests.html#cb142-1" tabindex="-1"></a><span class="co"># Test average treatment effect</span></span>
<span id="cb142-2"><a href="causal-forests.html#cb142-2" tabindex="-1"></a>ate <span class="ot">&lt;-</span> <span class="fu">average_treatment_effect</span>(cf)</span>
<span id="cb142-3"><a href="causal-forests.html#cb142-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Average Treatment Effect Analysis:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb142-4"><a href="causal-forests.html#cb142-4" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;ATE estimate:&quot;</span>, <span class="fu">round</span>(ate[<span class="st">&quot;estimate&quot;</span>], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb142-5"><a href="causal-forests.html#cb142-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Standard error:&quot;</span>, <span class="fu">round</span>(ate[<span class="st">&quot;std.err&quot;</span>], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb142-6"><a href="causal-forests.html#cb142-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;95% CI: [&quot;</span>, <span class="fu">round</span>(ate[<span class="st">&quot;estimate&quot;</span>] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> ate[<span class="st">&quot;std.err&quot;</span>], <span class="dv">3</span>),</span>
<span id="cb142-7"><a href="causal-forests.html#cb142-7" tabindex="-1"></a>    <span class="st">&quot;,&quot;</span>, <span class="fu">round</span>(ate[<span class="st">&quot;estimate&quot;</span>] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> ate[<span class="st">&quot;std.err&quot;</span>], <span class="dv">3</span>), <span class="st">&quot;]</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb142-8"><a href="causal-forests.html#cb142-8" tabindex="-1"></a></span>
<span id="cb142-9"><a href="causal-forests.html#cb142-9" tabindex="-1"></a><span class="co"># Test for significant heterogeneity</span></span>
<span id="cb142-10"><a href="causal-forests.html#cb142-10" tabindex="-1"></a>het_test <span class="ot">&lt;-</span> <span class="fu">test_calibration</span>(cf)</span>
<span id="cb142-11"><a href="causal-forests.html#cb142-11" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Heterogeneity Test Results:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb142-12"><a href="causal-forests.html#cb142-12" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Test statistic:&quot;</span>, <span class="fu">round</span>(het_test[<span class="st">&quot;estimate&quot;</span>], <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb142-13"><a href="causal-forests.html#cb142-13" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;P-value:&quot;</span>, <span class="fu">round</span>(het_test[<span class="st">&quot;pval&quot;</span>], <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb142-14"><a href="causal-forests.html#cb142-14" tabindex="-1"></a></span>
<span id="cb142-15"><a href="causal-forests.html#cb142-15" tabindex="-1"></a><span class="cf">if</span> (het_test[<span class="st">&quot;pval&quot;</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb142-16"><a href="causal-forests.html#cb142-16" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Result: Significant heterogeneity detected</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb142-17"><a href="causal-forests.html#cb142-17" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Interpretation: Personalized treatment rules recommended</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb142-18"><a href="causal-forests.html#cb142-18" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb142-19"><a href="causal-forests.html#cb142-19" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Result: No significant heterogeneity detected</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb142-20"><a href="causal-forests.html#cb142-20" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Interpretation: One-size-fits-all treatment may be appropriate</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb142-21"><a href="causal-forests.html#cb142-21" tabindex="-1"></a>}</span></code></pre></div>
<p>The average treatment effect estimate provides the population-level summary that traditional clinical trials report, while the heterogeneity test formally evaluates whether personalized treatment rules offer advantages over treating all patients identically. A significant test result provides statistical evidence that the observed variation in treatment effects represents true heterogeneity rather than random noise.</p>
</div>
<div id="visualization-and-pattern-discovery" class="section level3 hasAnchor" number="7.2.5">
<h3><span class="header-section-number">7.2.5</span> Visualization and Pattern Discovery<a href="causal-forests.html#visualization-and-pattern-discovery" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="causal-forests.html#cb143-1" tabindex="-1"></a><span class="co"># Prepare data for visualization</span></span>
<span id="cb143-2"><a href="causal-forests.html#cb143-2" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb143-3"><a href="causal-forests.html#cb143-3" tabindex="-1"></a>  <span class="at">age =</span> data<span class="sc">$</span>age,</span>
<span id="cb143-4"><a href="causal-forests.html#cb143-4" tabindex="-1"></a>  <span class="at">baseline_hba1c =</span> data<span class="sc">$</span>baseline_hba1c,</span>
<span id="cb143-5"><a href="causal-forests.html#cb143-5" tabindex="-1"></a>  <span class="at">bmi =</span> data<span class="sc">$</span>bmi,</span>
<span id="cb143-6"><a href="causal-forests.html#cb143-6" tabindex="-1"></a>  <span class="at">predicted_effect =</span> tau_hat,</span>
<span id="cb143-7"><a href="causal-forests.html#cb143-7" tabindex="-1"></a>  <span class="at">true_effect =</span> true_tau,</span>
<span id="cb143-8"><a href="causal-forests.html#cb143-8" tabindex="-1"></a>  <span class="at">prediction_se =</span> tau_se,</span>
<span id="cb143-9"><a href="causal-forests.html#cb143-9" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">factor</span>(W, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treatment&quot;</span>))</span>
<span id="cb143-10"><a href="causal-forests.html#cb143-10" tabindex="-1"></a>)</span>
<span id="cb143-11"><a href="causal-forests.html#cb143-11" tabindex="-1"></a></span>
<span id="cb143-12"><a href="causal-forests.html#cb143-12" tabindex="-1"></a><span class="co"># Validate predictions against truth</span></span>
<span id="cb143-13"><a href="causal-forests.html#cb143-13" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> true_effect, <span class="at">y =</span> predicted_effect)) <span class="sc">+</span></span>
<span id="cb143-14"><a href="causal-forests.html#cb143-14" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb143-15"><a href="causal-forests.html#cb143-15" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb143-16"><a href="causal-forests.html#cb143-16" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb143-17"><a href="causal-forests.html#cb143-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Causal Forest Prediction Accuracy&quot;</span>,</span>
<span id="cb143-18"><a href="causal-forests.html#cb143-18" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Correlation:&quot;</span>, <span class="fu">round</span>(<span class="fu">cor</span>(true_tau, tau_hat), <span class="dv">3</span>)),</span>
<span id="cb143-19"><a href="causal-forests.html#cb143-19" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;True Treatment Effect&quot;</span>, </span>
<span id="cb143-20"><a href="causal-forests.html#cb143-20" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Predicted Treatment Effect&quot;</span>) <span class="sc">+</span></span>
<span id="cb143-21"><a href="causal-forests.html#cb143-21" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-22"><a href="causal-forests.html#cb143-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span>
<span id="cb143-23"><a href="causal-forests.html#cb143-23" tabindex="-1"></a></span>
<span id="cb143-24"><a href="causal-forests.html#cb143-24" tabindex="-1"></a><span class="fu">print</span>(p1)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="causal-forests.html#cb145-1" tabindex="-1"></a><span class="co"># Create treatment effect heatmap</span></span>
<span id="cb145-2"><a href="causal-forests.html#cb145-2" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> baseline_hba1c)) <span class="sc">+</span></span>
<span id="cb145-3"><a href="causal-forests.html#cb145-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> predicted_effect), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb145-4"><a href="causal-forests.html#cb145-4" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;white&quot;</span>, <span class="at">high =</span> <span class="st">&quot;darkred&quot;</span>,</span>
<span id="cb145-5"><a href="causal-forests.html#cb145-5" tabindex="-1"></a>                       <span class="at">midpoint =</span> <span class="sc">-</span><span class="fl">0.75</span>,</span>
<span id="cb145-6"><a href="causal-forests.html#cb145-6" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">&quot;Predicted</span><span class="sc">\n</span><span class="st">Effect&quot;</span>,</span>
<span id="cb145-7"><a href="causal-forests.html#cb145-7" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(x, <span class="st">&quot;%&quot;</span>)) <span class="sc">+</span></span>
<span id="cb145-8"><a href="causal-forests.html#cb145-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Treatment Effect Heterogeneity Map&quot;</span>,</span>
<span id="cb145-9"><a href="causal-forests.html#cb145-9" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Green = larger benefits, Red = smaller benefits&quot;</span>,</span>
<span id="cb145-10"><a href="causal-forests.html#cb145-10" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Age (years)&quot;</span>, </span>
<span id="cb145-11"><a href="causal-forests.html#cb145-11" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Baseline HbA1c (%)&quot;</span>) <span class="sc">+</span></span>
<span id="cb145-12"><a href="causal-forests.html#cb145-12" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb145-13"><a href="causal-forests.html#cb145-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span>
<span id="cb145-14"><a href="causal-forests.html#cb145-14" tabindex="-1"></a></span>
<span id="cb145-15"><a href="causal-forests.html#cb145-15" tabindex="-1"></a><span class="fu">print</span>(p2)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-22-2.png" width="672" /></p>
<p>These visualizations demonstrate the causal forest’s ability to recover complex treatment effect patterns. The prediction accuracy plot shows strong agreement between true and predicted effects, validating the algorithm’s performance. The heterogeneity map reveals clinically interpretable patterns where younger patients with higher baseline HbA1c (shown in green) experience the largest treatment benefits, while older patients with better initial control (shown in red) show minimal response.</p>
</div>
<div id="personalized-treatment-strategy-development" class="section level3 hasAnchor" number="7.2.6">
<h3><span class="header-section-number">7.2.6</span> Personalized Treatment Strategy Development<a href="causal-forests.html#personalized-treatment-strategy-development" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="causal-forests.html#cb146-1" tabindex="-1"></a><span class="co"># Identify high-benefit patients</span></span>
<span id="cb146-2"><a href="causal-forests.html#cb146-2" tabindex="-1"></a>high_benefit_threshold <span class="ot">&lt;-</span> <span class="fu">quantile</span>(tau_hat, <span class="fl">0.25</span>)  <span class="co"># Bottom quartile (most negative)</span></span>
<span id="cb146-3"><a href="causal-forests.html#cb146-3" tabindex="-1"></a>high_benefit_patients <span class="ot">&lt;-</span> tau_hat <span class="sc">&lt;=</span> high_benefit_threshold</span>
<span id="cb146-4"><a href="causal-forests.html#cb146-4" tabindex="-1"></a></span>
<span id="cb146-5"><a href="causal-forests.html#cb146-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Personalized Treatment Strategy:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Personalized Treatment Strategy:</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="causal-forests.html#cb148-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;High-benefit threshold:&quot;</span>, <span class="fu">round</span>(high_benefit_threshold, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## High-benefit threshold: -0.788</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="causal-forests.html#cb150-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;High-benefit patients:&quot;</span>, <span class="fu">sum</span>(high_benefit_patients), </span>
<span id="cb150-2"><a href="causal-forests.html#cb150-2" tabindex="-1"></a>    <span class="st">&quot;(&quot;</span>, <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>(high_benefit_patients), <span class="dv">1</span>), <span class="st">&quot;% of population)</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## High-benefit patients: 500 ( 25 % of population)</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="causal-forests.html#cb152-1" tabindex="-1"></a><span class="co"># Compare patient characteristics</span></span>
<span id="cb152-2"><a href="causal-forests.html#cb152-2" tabindex="-1"></a>high_benefit_chars <span class="ot">&lt;-</span> data[high_benefit_patients, ]</span>
<span id="cb152-3"><a href="causal-forests.html#cb152-3" tabindex="-1"></a>regular_chars <span class="ot">&lt;-</span> data[<span class="sc">!</span>high_benefit_patients, ]</span>
<span id="cb152-4"><a href="causal-forests.html#cb152-4" tabindex="-1"></a></span>
<span id="cb152-5"><a href="causal-forests.html#cb152-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">High-Benefit Patient Profile:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## High-Benefit Patient Profile:</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="causal-forests.html#cb154-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean age:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(high_benefit_chars<span class="sc">$</span>age), <span class="dv">1</span>), <span class="st">&quot;years</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Mean age: 67.4 years</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="causal-forests.html#cb156-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean baseline HbA1c:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(high_benefit_chars<span class="sc">$</span>baseline_hba1c), <span class="dv">2</span>), <span class="st">&quot;%</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Mean baseline HbA1c: 9.79 %</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="causal-forests.html#cb158-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean BMI:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(high_benefit_chars<span class="sc">$</span>bmi), <span class="dv">1</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Mean BMI: 30.6</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="causal-forests.html#cb160-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Regular Patient Profile:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Regular Patient Profile:</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="causal-forests.html#cb162-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean age:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(regular_chars<span class="sc">$</span>age), <span class="dv">1</span>), <span class="st">&quot;years</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Mean age: 57.2 years</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="causal-forests.html#cb164-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean baseline HbA1c:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(regular_chars<span class="sc">$</span>baseline_hba1c), <span class="dv">2</span>), <span class="st">&quot;%</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Mean baseline HbA1c: 8.13 %</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="causal-forests.html#cb166-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean BMI:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(regular_chars<span class="sc">$</span>bmi), <span class="dv">1</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Mean BMI: 30</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="causal-forests.html#cb168-1" tabindex="-1"></a><span class="co"># Evaluate treatment strategies</span></span>
<span id="cb168-2"><a href="causal-forests.html#cb168-2" tabindex="-1"></a>control_outcome <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y[W <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb168-3"><a href="causal-forests.html#cb168-3" tabindex="-1"></a>treat_all_outcome <span class="ot">&lt;-</span> control_outcome <span class="sc">+</span> <span class="fu">mean</span>(tau_hat)</span>
<span id="cb168-4"><a href="causal-forests.html#cb168-4" tabindex="-1"></a>selective_outcome <span class="ot">&lt;-</span> control_outcome <span class="sc">+</span> <span class="fu">mean</span>(tau_hat[high_benefit_patients]) <span class="sc">*</span> <span class="fu">mean</span>(high_benefit_patients)</span>
<span id="cb168-5"><a href="causal-forests.html#cb168-5" tabindex="-1"></a></span>
<span id="cb168-6"><a href="causal-forests.html#cb168-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Treatment Strategy Comparison:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Treatment Strategy Comparison:</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="causal-forests.html#cb170-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;No treatment:&quot;</span>, <span class="fu">round</span>(control_outcome, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## No treatment: 1.994</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="causal-forests.html#cb172-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Treat everyone:&quot;</span>, <span class="fu">round</span>(treat_all_outcome, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Treat everyone: 1.458</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="causal-forests.html#cb174-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Selective treatment:&quot;</span>, <span class="fu">round</span>(selective_outcome, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Selective treatment: 1.754</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="causal-forests.html#cb176-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Selective strategy benefit:&quot;</span>, <span class="fu">round</span>(selective_outcome <span class="sc">-</span> control_outcome, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Selective strategy benefit: -0.241</code></pre>
<p>The personalized treatment analysis identifies patients most likely to benefit from the new medication, enabling targeted therapy that maximizes clinical benefit while minimizing unnecessary exposure. High-benefit patients are characterized by younger age and poorer baseline glycemic control, providing clear clinical criteria for treatment decisions.</p>
</div>
<div id="partial-dependence-analysis" class="section level3 hasAnchor" number="7.2.7">
<h3><span class="header-section-number">7.2.7</span> Partial Dependence Analysis<a href="causal-forests.html#partial-dependence-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="causal-forests.html#cb178-1" tabindex="-1"></a><span class="co"># Generate partial dependence plots for interpretation</span></span>
<span id="cb178-2"><a href="causal-forests.html#cb178-2" tabindex="-1"></a>age_sequence <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">30</span>, <span class="dv">80</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb178-3"><a href="causal-forests.html#cb178-3" tabindex="-1"></a>age_effects <span class="ot">&lt;-</span> <span class="fu">sapply</span>(age_sequence, <span class="cf">function</span>(target_age) {</span>
<span id="cb178-4"><a href="causal-forests.html#cb178-4" tabindex="-1"></a>  X_modified <span class="ot">&lt;-</span> X</span>
<span id="cb178-5"><a href="causal-forests.html#cb178-5" tabindex="-1"></a>  X_modified[, <span class="st">&quot;age&quot;</span>] <span class="ot">&lt;-</span> target_age</span>
<span id="cb178-6"><a href="causal-forests.html#cb178-6" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">predict</span>(cf, X_modified)<span class="sc">$</span>predictions)</span>
<span id="cb178-7"><a href="causal-forests.html#cb178-7" tabindex="-1"></a>})</span>
<span id="cb178-8"><a href="causal-forests.html#cb178-8" tabindex="-1"></a></span>
<span id="cb178-9"><a href="causal-forests.html#cb178-9" tabindex="-1"></a>hba1c_sequence <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">7</span>, <span class="dv">11</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb178-10"><a href="causal-forests.html#cb178-10" tabindex="-1"></a>hba1c_effects <span class="ot">&lt;-</span> <span class="fu">sapply</span>(hba1c_sequence, <span class="cf">function</span>(target_hba1c) {</span>
<span id="cb178-11"><a href="causal-forests.html#cb178-11" tabindex="-1"></a>  X_modified <span class="ot">&lt;-</span> X</span>
<span id="cb178-12"><a href="causal-forests.html#cb178-12" tabindex="-1"></a>  X_modified[, <span class="st">&quot;baseline_hba1c&quot;</span>] <span class="ot">&lt;-</span> target_hba1c</span>
<span id="cb178-13"><a href="causal-forests.html#cb178-13" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">predict</span>(cf, X_modified)<span class="sc">$</span>predictions)</span>
<span id="cb178-14"><a href="causal-forests.html#cb178-14" tabindex="-1"></a>})</span>
<span id="cb178-15"><a href="causal-forests.html#cb178-15" tabindex="-1"></a></span>
<span id="cb178-16"><a href="causal-forests.html#cb178-16" tabindex="-1"></a><span class="co"># Visualize partial dependence</span></span>
<span id="cb178-17"><a href="causal-forests.html#cb178-17" tabindex="-1"></a>age_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> age_sequence, <span class="at">effect =</span> age_effects)</span>
<span id="cb178-18"><a href="causal-forests.html#cb178-18" tabindex="-1"></a>hba1c_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">hba1c =</span> hba1c_sequence, <span class="at">effect =</span> hba1c_effects)</span>
<span id="cb178-19"><a href="causal-forests.html#cb178-19" tabindex="-1"></a></span>
<span id="cb178-20"><a href="causal-forests.html#cb178-20" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(age_df, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> effect)) <span class="sc">+</span></span>
<span id="cb178-21"><a href="causal-forests.html#cb178-21" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb178-22"><a href="causal-forests.html#cb178-22" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb178-23"><a href="causal-forests.html#cb178-23" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb178-24"><a href="causal-forests.html#cb178-24" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Treatment Effect by Age&quot;</span>,</span>
<span id="cb178-25"><a href="causal-forests.html#cb178-25" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Average effect holding other characteristics constant&quot;</span>,</span>
<span id="cb178-26"><a href="causal-forests.html#cb178-26" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Age (years)&quot;</span>, </span>
<span id="cb178-27"><a href="causal-forests.html#cb178-27" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Average Treatment Effect&quot;</span>) <span class="sc">+</span></span>
<span id="cb178-28"><a href="causal-forests.html#cb178-28" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb178-29"><a href="causal-forests.html#cb178-29" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span>
<span id="cb178-30"><a href="causal-forests.html#cb178-30" tabindex="-1"></a></span>
<span id="cb178-31"><a href="causal-forests.html#cb178-31" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hba1c_df, <span class="fu">aes</span>(<span class="at">x =</span> hba1c, <span class="at">y =</span> effect)) <span class="sc">+</span></span>
<span id="cb178-32"><a href="causal-forests.html#cb178-32" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb178-33"><a href="causal-forests.html#cb178-33" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb178-34"><a href="causal-forests.html#cb178-34" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb178-35"><a href="causal-forests.html#cb178-35" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Treatment Effect by Baseline HbA1c&quot;</span>,</span>
<span id="cb178-36"><a href="causal-forests.html#cb178-36" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Average effect holding other characteristics constant&quot;</span>,</span>
<span id="cb178-37"><a href="causal-forests.html#cb178-37" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Baseline HbA1c (%)&quot;</span>, </span>
<span id="cb178-38"><a href="causal-forests.html#cb178-38" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Average Treatment Effect&quot;</span>) <span class="sc">+</span></span>
<span id="cb178-39"><a href="causal-forests.html#cb178-39" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb178-40"><a href="causal-forests.html#cb178-40" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span>
<span id="cb178-41"><a href="causal-forests.html#cb178-41" tabindex="-1"></a></span>
<span id="cb178-42"><a href="causal-forests.html#cb178-42" tabindex="-1"></a><span class="fu">print</span>(p3)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="causal-forests.html#cb179-1" tabindex="-1"></a><span class="fu">print</span>(p4)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-24-2.png" width="672" /></p>
<p>Partial dependence plots provide intuitive visualization of how treatment effects vary along key patient dimensions while holding other characteristics constant. The age effect shows declining benefits with advancing age, possibly reflecting reduced physiological responsiveness or competing health priorities in older patients. The baseline HbA1c effect demonstrates the “room for improvement” principle where patients with worse initial control have greater potential for benefit.</p>
</div>
</div>
<div id="clinical-insights-and-limitations" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Clinical Insights and Limitations<a href="causal-forests.html#clinical-insights-and-limitations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The causal forest analysis reveals clinically meaningful patterns of treatment heterogeneity that support personalized diabetes care. The algorithm successfully identifies that younger patients with poor baseline glycemic control represent optimal candidates for the new medication, achieving HbA1c reductions exceeding 2 percentage points compared to minimal benefits for older patients with better initial control. This pattern aligns with clinical understanding of diabetes pathophysiology where patients with greater metabolic dysfunction often show more dramatic responses to effective interventions.</p>
<p>Treatment benefits decrease approximately 0.02 percentage points per year of age, reflecting reduced physiological responsiveness or competing health priorities in older patients. Each 1% increase in baseline HbA1c associates with greater treatment benefits, demonstrating the “room for improvement” principle where patients with worse initial control have greater potential for benefit. These insights translate directly into clinical decision rules that physicians can apply in practice.</p>
<p>Implementation in clinical practice would involve integrating the causal forest model into electronic health record systems where patient characteristics automatically generate personalized treatment effect predictions. The partial dependence plots provide interpretable summaries that help physicians understand and trust the algorithm’s recommendations, while the variable importance measures guide data collection priorities for optimal model performance.</p>
<p>The confidence intervals around individual predictions reflect appropriate uncertainty about treatment effects, with wider intervals in regions of the covariate space where fewer patients provide evidence. This honest uncertainty quantification helps clinicians understand when predictions are most reliable and when additional caution or monitoring might be warranted.</p>
<p>Causal forests inherit important limitations from both machine learning and causal inference methodologies that practitioners must understand for successful implementation. The method requires substantial sample sizes for reliable estimation, particularly in high-dimensional settings where the curse of dimensionality affects local estimation procedures. Clinical datasets with fewer than several thousand patients may lack sufficient power for stable treatment effect estimation, especially when investigating numerous patient characteristics simultaneously.</p>
<p>The honesty requirement, while theoretically essential for valid inference, reduces effective sample sizes by requiring strict separation between structure learning and effect estimation. This creates practical tradeoffs between statistical rigor and estimation precision that may favor alternative approaches in moderate-sized datasets. Model interpretability represents another consideration, as causal forests provide less transparent decision rules compared to parametric approaches. Understanding why specific patients receive particular treatment effect predictions requires additional analysis through partial dependence plots, variable importance measures, or other post-hoc explanation methods.</p>
<p>The method assumes that treatment effect heterogeneity follows patterns amenable to tree-based discovery, potentially missing complex interactions or highly nonlinear relationships that don’t align with recursive partitioning logic. Alternative approaches using kernel methods, neural networks, or other flexible machine learning techniques might capture different types of heterogeneity patterns.</p>
<p>Sensitivity to unmeasured confounding remains a fundamental challenge, as causal forests cannot overcome violations of the unconfoundedness assumption. While randomized trial data eliminates this concern by design, observational applications require careful consideration of potential hidden confounders that might bias treatment effect estimates.</p>
<p>Recent methodological developments extend causal forests to increasingly complex settings that expand their practical applicability. Researchers have developed instrumental variable versions that maintain the flexibility of forest-based estimation while addressing identification challenges in observational studies where unmeasured confounding threatens validity. These extensions enable personalized treatment effect estimation even when randomized assignment is impossible or unethical.</p>
<p>Integration with adaptive experimental designs represents another promising direction where treatment assignments update based on accumulating evidence about individual responses. This enables real-time personalization in clinical trials or digital health interventions while maintaining statistical rigor through principled sequential decision-making. Such designs could dramatically accelerate the development of personalized treatment protocols by efficiently exploring treatment effect heterogeneity during the trial itself.</p>
<p>Fairness considerations become increasingly important as personalized algorithms influence clinical decisions that may affect different population groups differently. When some patient subgroups benefit more than others from new treatments, personalized algorithms might exacerbate existing health disparities if not carefully designed. Researchers are developing methods to incorporate equity constraints into causal forest algorithms, ensuring that personalized treatments promote rather than undermine health equity goals.</p>
<p>Multi-outcome extensions allow simultaneous modeling of treatment effects on multiple endpoints, capturing tradeoffs between efficacy and safety outcomes that characterize real-world treatment decisions. For diabetes care, this might involve jointly modeling HbA1c reduction, weight changes, and hypoglycemia risk to develop treatment recommendations that optimize overall patient benefit rather than single-outcome effects.</p>
</div>
<div id="conclusion-5" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Conclusion<a href="causal-forests.html#conclusion-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Causal forests represent a transformative advance in our ability to understand and exploit treatment effect heterogeneity for personalized medicine and targeted interventions. By combining the pattern-recognition capabilities of machine learning with the statistical rigor of causal inference theory, the method enables automatic discovery of complex treatment effect patterns while providing honest uncertainty quantification that supports clinical decision-making.</p>
<p>Our precision medicine application demonstrates the method’s practical value for developing personalized diabetes treatment protocols based on patient characteristics. The algorithm successfully identifies clinically meaningful subgroups with different treatment responses, providing interpretable insights about which patients benefit most from new interventions. Variable importance measures and partial dependence plots translate complex algorithmic outputs into actionable clinical guidance that physicians can understand and apply.</p>
<p>The theoretical guarantees regarding asymptotic normality and confidence interval coverage represent crucial advances over ad-hoc machine learning approaches to causal inference that ignore model selection uncertainty. These honest inference procedures ensure that the adaptive nature of tree-based methods doesn’t compromise statistical validity, providing reliable foundations for high-stakes clinical decisions.</p>
<p>Successful implementation requires careful attention to sample size requirements, assumption verification, and validation strategies. The method works best as part of comprehensive analytical approaches that combine algorithmic insights with domain expertise, clinical judgment, and careful consideration of implementation challenges. Future research continues expanding the framework to handle unmeasured confounding, multiple outcomes, and fairness constraints while developing computational improvements that enable application to massive healthcare datasets.</p>
<p>When applied appropriately with adequate sample sizes and valid identifying assumptions, causal forests provide powerful tools for precision medicine, targeted policy interventions, and any domain where treatment effects vary meaningfully across individuals. The method’s combination of statistical rigor, computational efficiency, and practical interpretability establishes it as an essential component of the modern causal inference toolkit for researchers and practitioners seeking to understand and exploit treatment effect heterogeneity.</p>
<p>The diabetes treatment application illustrates how causal forests can transform clinical practice by moving beyond one-size-fits-all approaches toward truly personalized medicine. By automatically discovering that younger patients with poor glycemic control benefit most from new treatments while older patients with better initial control show minimal response, the algorithm provides actionable insights that directly inform treatment decisions. This represents a fundamental shift from traditional clinical decision-making based on average effects toward precision medicine grounded in individual patient characteristics.</p>
<p>The ultimate promise of causal forests extends beyond technical innovation to clinical impact—enabling physicians to make treatment decisions based on rigorous statistical evidence about individual patient benefit rather than population averages that may not apply to the specific patient sitting in their office. This represents not just methodological progress but a fundamental advancement toward more effective, efficient, and equitable healthcare delivery that maximizes benefit for each individual patient while optimizing resource allocation across entire populations.</p>
</div>
<div id="references-4" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> References<a href="causal-forests.html#references-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Wager, S., &amp; Athey, S. (2018). Estimation and inference of heterogeneous treatment effects using random forests. <em>Journal of the American Statistical Association</em>, 113(523), 1228-1242.</li>
<li>Athey, S., Tibshirani, J., &amp; Wager, S. (2019). Generalized random forests. <em>The Annals of Statistics</em>, 47(2), 1148-1178.</li>
<li>Chernozhukov, V., Chetverikov, D., Demirer, M., Duflo, E., Hansen, C., Newey, W., &amp; Robins, J. (2018). Double/debiased machine learning for treatment and structural parameters. <em>The Econometrics Journal</em>, 21(1), C1-C68.</li>
<li>Künzel, S. R., Sekhon, J. S., Bickel, P. J., &amp; Yu, B. (2019). Metalearners for estimating heterogeneous treatment effects using machine learning. <em>Proceedings of the National Academy of Sciences</em>, 116(10), 4156-4165.</li>
<li>Tibshirani, J., Athey, S., Friedberg, R., Hadad, V., Hirshberg, D., Miner, L., … &amp; Wager, S. (2020). grf: Generalized Random Forests. <em>R package version</em>, 1.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="causal-inference-in-practice-v-regression-discontinuity-design.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bayesian-structural-time-series-for-causal-inference.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/Kamran-Afzali/Bookdown_Causality/edit/main/07-CSLFRST.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": "https://github.com/Kamran-Afzali/Bookdown_Causality/blob/main/07-CSLFRST.Rmd",
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
